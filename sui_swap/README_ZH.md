# SUI Swap

中文 | [English](README.md)

SUI Swap是基于SUI区块链的自动做市商(AMM)协议，采用恒定乘积模型(x*y=k)进行代币交换。该项目实现了一个完整的去中心化交易所(DEX)核心功能，允许用户添加流动性并进行代币交换。

## 相关文档

- [部署和调用指南](OPERATION_GUIDE_ZH.md): 详细的部署步骤和 sui client 调用示例 (中文版)
- [Deployment and Usage Guide](OPERATION_GUIDE.md): 部署和调用指南 (英文版)

## 核心功能

- **流动性池管理**: 创建和管理任意两种代币间的交易对
- **添加/移除流动性**: 用户可向池中添加流动性获取LP代币，也可销毁LP代币取回原始代币
- **代币交换**: 基于恒定乘积公式的高效代币兑换
- **费用机制**: 每笔交易收取可配置的交易费用，奖励给流动性提供者
- **LP代币价值计算**: 支持计算LP代币的实时价值和收益情况

## 项目架构

项目由四个主要模块组成:

- `factory.move`: 工厂合约，负责创建和注册流动性池
- `liquidity_pool.move`: 流动性池实现，管理代币储备和交换逻辑
- `swap.move`: 交换逻辑和价格计算
- `sui_swap.move`: 用户接口函数

## 权限设计

本项目实现了安全的权限控制机制:

- **流动性池创建**: 仅工厂所有者可创建新的流动性池，确保质量控制
- **费率管理**: 仅工厂所有者可更新默认交易费率
- **所有权转移**: 工厂所有者可将所有权转移给新地址

## 使用指南

1. **创建工厂**:
   - 初始化时自动创建工厂合约
   - 工厂所有者为初始部署者
   - 默认手续费率为0.3%

2. **创建流动性池**:
   - 仅工厂所有者可创建新的流动性池
   - 支持两种创建方式：
     - 使用自定义费率创建
     - 使用默认费率(0.3%)创建
   - 创建时需要提供初始代币数量

3. **添加流动性**:
   - 任何用户可向已存在的池添加流动性
   - 获得与贡献比例相应的LP代币
   - 自动处理代币数量不匹配的情况，返回剩余代币
   - 支持任意比例的代币添加

4. **交换代币**:
   - 支持双向代币交换（X->Y和Y->X）
   - 用户可在流动性池中进行代币交换
   - 支持设置最低收款金额和截止时间
   - 自动计算滑点保护
   - 交易失败时自动回滚

5. **移除流动性**:
   - LP代币持有者可随时移除流动性
   - 按比例获得池中的原始代币和累积的手续费
   - 支持部分或全部移除

6. **LP代币价值计算**:
   - 支持计算任意数量LP代币对应的代币价值
   - 可计算LP代币持有者的收益情况

7. **工厂管理**:
   - 工厂所有者可更新默认交易费率
   - 支持工厂所有权转移
   - 可查看所有已创建的流动性池

## 技术特点

- **大数处理**: 使用u128进行大数计算，避免整数溢出
- **精确计算**: 采用精确的数学计算避免舍入错误
- **事件系统**: 完整的事件记录，便于链下追踪和分析
- **类型安全**: 严格的类型检查确保交易安全

## 安全考量

- 采用精确的数学计算避免溢出和舍入错误
- 所有关键操作均有权限检查
- 完善的测试覆盖率确保功能正确性
- 使用u128进行大数计算，防止整数溢出
- 严格的类型检查和边界条件验证
- 完整的错误处理机制 